<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.12.2 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>ROC curves Confution matrix – what are they and how are they used? - Tuấn Anh</title>
<meta name="description" content="">



<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Tuấn Anh">
<meta property="og:title" content="ROC curves Confution matrix – what are they and how are they used?">
<meta property="og:url" content="http://localhost:4000/portfolio/Cach-tinh-ROC-curve/">


  <meta property="og:description" content="">



  <meta property="og:image" content="http://localhost:4000/assets/images/postimg/cm.jpeg">



  <meta name="twitter:site" content="@tuananhktmt">
  <meta name="twitter:title" content="ROC curves Confution matrix – what are they and how are they used?">
  <meta name="twitter:description" content="">
  <meta name="twitter:url" content="http://localhost:4000/portfolio/Cach-tinh-ROC-curve/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="http://localhost:4000/assets/images/postimg/cm.jpeg">
  

  



  <meta property="article:published_time" content="2018-12-26T00:00:00+08:00">





  
    <meta property="article:publisher" content="https://www.facebook.com/">
  

  
    <meta property="fb:app_id" content="2341188262621006">
  


<link rel="canonical" href="http://localhost:4000/portfolio/Cach-tinh-ROC-curve/">





  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Organization",
      "url": "http://localhost:4000",
      "logo": "http://localhost:4000/assets/images/default.jpg"
    }
  </script>



  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Tuấn Anh",
      "url": "http://localhost:4000",
      "sameAs": ["https://twitter.com/tuananhktmt","https://www.facebook.com/"]
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Tuấn Anh Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
      inlineMath: [['$','$']]
    }
  });
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<!-- https://stackoverflow.com/questions/26275645/how-to-support-latex-in-github-pages-->

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<meta name="theme-color" content="#ffffff">
  </head>

  <body class="layout--single">


    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = 'https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v3.2&appId=2341188262621006&autoLogAppEvents=1';
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>


    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">Tuấn Anh</a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/" >HOME</a>
            </li><li class="masthead__menu-item">
              <a href="/portfolio/" >PORTFOLIO</a>
            </li><li class="masthead__menu-item">
              <a href="/blog/" >BLOG</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/" >Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/tags/" >Tags</a>
            </li><li class="masthead__menu-item">
              <a href="/contact/" >CONTACT</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  











<div class="page__hero--overlay"
  style="background-color: #0f0; background-image: linear-gradient(rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.3)), url('/assets/images/postimg/cm.jpeg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          ROC curves Confution matrix – what are they and how are they used?

        
      </h1>
      
        <p class="page__lead">
</p>
      
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
        <img src=
        
          "/assets/images/postimg/cm1.png"
        
        alt="logo">
      
      <h3>Papers</h3>
      <p>Nghiên cứu khoa học</p>

    
      
      <h3></h3>
      

    
    
  
  </div>



  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="ROC curves Confution matrix – what are they and how are they used?">
    <meta itemprop="description" content="">
    <meta itemprop="datePublished" content="December 26, 2018">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
             
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#what-is-confusion-matrix-and-why-you-need-it">What is Confusion Matrix and why you need it?</a>
      - {:.} <a href="#true-positive">True Positive:</a>
      - {:.} <a href="#true-negative">True Negative:</a>
      - {:.} <a href="#false-positive-type-1-error">False Positive: (Type 1 Error)</a>
      - {:.} <a href="#false-negative-type-2-error">False Negative: (Type 2 Error)</a>
    <ul>
      <li><a href="#how-to-calculate-confusion-matrix-for-a-2-class-classification-problem">How to Calculate Confusion Matrix for a 2-class classification problem?</a>
        <ul>
          <li><a href="#recall">Recall</a></li>
          <li><a href="#precision">Precision</a></li>
          <li><a href="#f-measure">F-measure</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#cách-vẽ-roc-curve">Cách vẽ ROC curve</a></li>
</ul>

            </nav>
          </aside>

        
        <!-- Ảnh to đầu bài  -->
<p><img src="/assets/images/postimg/cm.jpeg" alt="" /></p>

<h1 id="what-is-confusion-matrix-and-why-you-need-it">What is Confusion Matrix and why you need it?</h1>

<p>Well, it is a performance measurement for machine learning classification problem where output can be two or more classes. It is a table with 4 different combinations of predicted and actual values.</p>

<p><img src="/assets/images/postimg/cm4.png" alt="" /></p>

<p>It is extremely useful for measuring Recall, Precision, Specificity, Accuracy and most importantly AUC-ROC Curve.</p>

<p>Let’s understand TP, FP, FN, TN in terms of pregnancy analogy.
<img src="/assets/images/postimg/cm1.png" alt="" /></p>

<h3 id="true-positive">True Positive:</h3>

<p>Interpretation: You predicted positive and it’s true.</p>

<p>You predicted that a woman is pregnant and she actually is.</p>

<h3 id="true-negative">True Negative:</h3>

<p>Interpretation: You predicted negative and it’s true.</p>

<p>You predicted that a man is not pregnant and he actually is not.</p>

<h3 id="false-positive-type-1-error">False Positive: (Type 1 Error)</h3>

<p>Interpretation: You predicted positive and it’s false.</p>

<p>You predicted that a man is pregnant but he actually is not.</p>

<h3 id="false-negative-type-2-error">False Negative: (Type 2 Error)</h3>

<p>Interpretation: You predicted negative and it’s false.</p>

<p>You predicted that a woman is not pregnant but she actually is.</p>

<p>Just Remember, We describe predicted values as Positive and Negative and actual values as True and False.</p>

<p><img src="https://cdn-images-1.medium.com/max/800/1*2lptVD05HarbzGKiZ44l5A.png" alt="" /></p>

<h2 id="how-to-calculate-confusion-matrix-for-a-2-class-classification-problem">How to Calculate Confusion Matrix for a 2-class classification problem?</h2>

<p><img src="/assets/images/postimg/cm2.png" alt="" /></p>

<p><img src="/assets/images/postimg/cm3.png" alt="" /></p>

<p>Let’s understand confusion matrix through math.</p>

<h3 id="recall">Recall</h3>

<script type="math/tex; mode=display">Recall=\frac{TP}{TP+FN}</script>

<p>Out of all the positive classes, how much we predicted correctly. It should be high as possible.</p>

<h3 id="precision">Precision</h3>

<script type="math/tex; mode=display">Precision=\frac{TP}{TP+FP}</script>

<p>Out of all the classes, how much we predicted correctly. It should be high as possible.</p>

<h3 id="f-measure">F-measure</h3>

<script type="math/tex; mode=display">F-measure=\frac{2*Recall*Precision}{Recall+Precision}</script>

<p>It is difficult to compare two models with low precision and high recall or vice versa. So to make them comparable, we use F-Score. F-score helps to measure Recall and Precision at the same time. It uses Harmonic Mean in place of Arithmetic Mean by punishing the extreme values more.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#Calculate Confusion matrix for string</span>
<span class="k">class</span> <span class="nc">CONFUSION_MATRIX</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">KWS</span><span class="o">=</span><span class="p">[</span><span class="s">'_'</span><span class="p">,</span> <span class="s">'b'</span><span class="p">,</span> <span class="s">'c'</span><span class="p">,</span> <span class="s">'d'</span><span class="p">,</span> <span class="s">'e'</span><span class="p">,</span> <span class="s">'f'</span><span class="p">,</span> <span class="s">'g'</span><span class="p">]):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CONFUSION_MATRIX</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TP</span><span class="o">=</span><span class="p">[];</span><span class="bp">self</span><span class="o">.</span><span class="n">TN</span><span class="o">=</span><span class="p">[];</span><span class="bp">self</span><span class="o">.</span><span class="n">FP</span><span class="o">=</span><span class="p">[];</span><span class="bp">self</span><span class="o">.</span><span class="n">FN</span><span class="o">=</span><span class="p">[];</span><span class="bp">self</span><span class="o">.</span><span class="n">CM</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">KWS</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">KWS</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">Calc_Confusion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ORG</span><span class="p">,</span><span class="n">APP</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">str_dict_compare</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>  <span class="n">d1_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="p">);</span><span class="n">d2_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span><span class="o">==</span><span class="nb">set</span><span class="p">:</span><span class="n">d1_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d1</span><span class="o">.</span><span class="n">keys</span><span class="p">());</span><span class="n">d2_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">d2</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span><span class="k">print</span><span class="p">(</span><span class="s">'Type {} not supported, in class CONFUSION_MATRIX'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">d1</span><span class="p">)));</span><span class="k">return</span>
            <span class="n">intersect_keys</span> <span class="o">=</span> <span class="n">d1_keys</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">d2_keys</span><span class="p">)</span>
            <span class="n">added</span> <span class="o">=</span> <span class="n">d1_keys</span> <span class="o">-</span> <span class="n">d2_keys</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="n">d2_keys</span> <span class="o">-</span> <span class="n">d1_keys</span>
            <span class="n">same</span><span class="o">=</span><span class="n">d2_keys</span><span class="o">-</span><span class="n">removed</span>
            <span class="k">return</span> <span class="n">added</span><span class="p">,</span> <span class="n">removed</span><span class="p">,</span><span class="n">same</span>  
        <span class="n">added</span><span class="p">,</span> <span class="n">removed</span><span class="p">,</span><span class="n">same</span><span class="o">=</span><span class="n">str_dict_compare</span><span class="p">(</span><span class="n">ORG</span><span class="p">,</span><span class="n">APP</span><span class="p">)</span>
        <span class="n">CM</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CM</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">same</span><span class="p">:</span><span class="n">CM</span><span class="p">[</span><span class="n">KWS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="n">KWS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">+=</span><span class="mi">1</span>
<span class="c">#         if len(same)&gt;0:removed={};added={} # This audio found!</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">removed</span><span class="p">:</span><span class="n">CM</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">KWS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span><span class="o">-=</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">added</span><span class="p">:</span><span class="n">CM</span><span class="p">[</span><span class="n">KWS</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="mi">0</span><span class="p">]</span><span class="o">-=</span><span class="mi">1</span>
        <span class="n">CM</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">+=</span><span class="nb">int</span><span class="p">(</span><span class="n">ORG</span><span class="o">==</span><span class="n">ORG</span><span class="o">==</span><span class="s">''</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">CM</span><span class="o">=</span><span class="n">CM</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">same</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FP</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">removed</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">added</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TN</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ORG</span><span class="o">==</span><span class="n">ORG</span><span class="o">==</span><span class="s">''</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">Cal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="n">total</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">su</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="n">q</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">su</span><span class="o">+=</span><span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">q</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">su</span><span class="o">/</span><span class="n">total</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">q</span>
    <span class="k">def</span> <span class="nf">Final_Calc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TPR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TP</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FPR</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">Cal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">FP</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">plotCM</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Final_Calc</span><span class="p">()</span>
        <span class="n">TN</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CM</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span><span class="bp">self</span><span class="o">.</span><span class="n">CM</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">df_cm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CM</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">),</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">KWS</span><span class="p">,</span><span class="n">index</span><span class="o">=</span> <span class="n">KWS</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">17</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
        <span class="n">sn</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">df_cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="s">"PiYG"</span><span class="p">,</span><span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s">'lightgray'</span><span class="p">,</span>
                  <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s">"orientation"</span><span class="p">:</span> <span class="s">"vertical"</span><span class="p">,</span><span class="s">"label"</span><span class="p">:</span> <span class="s">"Number of accidents"</span><span class="p">}</span>
                  <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CM</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">TN</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">0.2</span><span class="p">,</span> <span class="s">'</span><span class="si">%</span><span class="s">d'</span> <span class="o">%</span> <span class="n">TN</span><span class="p">,</span><span class="n">ha</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span><span class="n">va</span><span class="o">=</span><span class="s">'center'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="s">'--r'</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TPR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">FPR</span><span class="p">)</span>


<span class="n">cf</span><span class="o">=</span><span class="n">CONFUSION_MATRIX</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'/home/u/2018/ViVos/data/ViVos_08/LSTM4Layer_500/LSTM4Layer_500_chkPoint.pkl.predict.txt'</span><span class="p">)</span><span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">txt</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
<span class="n">txt</span><span class="o">=</span><span class="p">[</span><span class="n">ss</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'|'</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">ss</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ORG</span><span class="p">,</span> <span class="n">APP</span> <span class="ow">in</span> <span class="n">txt</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="n">cf</span><span class="o">.</span><span class="n">Calc_Confusion</span><span class="p">(</span><span class="n">ORG</span><span class="p">,</span><span class="n">APP</span><span class="p">)</span>

<span class="n">cf</span><span class="o">.</span><span class="n">plotCM</span><span class="p">()</span>
</code></pre></div></div>

<p>Results:</p>

<p><img src="/assets/images/postimg/cm.png" alt="" /></p>

<h1 id="cách-vẽ-roc-curve">Cách vẽ ROC curve</h1>

<p>Nhìn cái hình này rất dễ hiểu:</p>

<p><img src="/assets/images/postimg/ROC.gif" alt="" /></p>

<p>Trong đó: C là cột giá trị dự đoán đúng/sai so với True label. Score là điểm số của hàm predict output (Model của mình không có cái này, nên bỏ qua thôi) Nếu có score, thì trước khi vẽ, phải sắp xếp theo score, có thể tăng dần/giảm dần, đồ thị sẽ khác đi đấy. trong hình này là giảm dần. còn của ví dụ dưới đây là tăng dần.</p>

<p>Có một ví dụ khá trực quan tại đây: <a href="https://docs.eyesopen.com/toolkits/cookbook/python/plotting/roc.html#figure-depiction-roc">Drawing ROC Curve</a>, nhưng ví dụ này bị lỗ hở ở chỗ này:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</code></pre></div></div>
<p>Mình đã thử độc chính xác của thuật toán bằng cách nhân đôi kết quả, và phát hiện: Họ che đậy phần thừa ở hình vẽ, nhưng nếu chúng ta bỏ hai lệnh này đi, thì phần ẩn sẽ lộ ra, không thể hiện thị chuẩn được nữa. Sai ở chỗ, nó chỉ hiển thị phần đầu, còn các phần sau nó ẩn đi, vậy, nếu đoạn đầu của DL hiển thị rất ngon, predic rất tốt, còn đoạn sau đoán toàn sai thì sao? - k nhìn thấy!. Nếu cùng 1 dữ liệu, ta xáo trộn nó đi, thì ROC curve trên tập DL sẽ không còn giống nhau nữa=&gt; khả năng cao là sai.</p>

<p>à nhầm, nó bao biện bằng cách: thêm hàm</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sortedscores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></div>

<p>(sort scores by ascending order) nếu vậy, hai model khác nhau, M1 đoán thiên về hoặc đúng, hoặc sai =&gt; score của M1 dồn về 2 phía 0/1 =&gt; số phần tử sai có score thấp và số đúng score cao nhiều hơn, còn M2 đoán sâm sấp tăng dần đều, nhưng tổng số dự đoán đúng của M1&gt;M2, thì khi nhìn vào ROC ta vẫn thấy M2 tốt hơn M1 (vì chỉ in đoạn đầu, đoạn đầu M1 sai nhiều hơn) =&gt; không đánh giá đúng tổng quan hệ thống.</p>

<p>Xem thêm ở file này: <a href="http://www.cs.ru.nl/~tomh/onderwijs/dm/dm_files/roc_auc.pdf">Roc-Auc</a> và ở <a href="https://people.inf.elte.hu/kiss/11dwhdm/roc.pdf">đây nữa</a></p>

<p>code:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_rates</span><span class="p">(</span><span class="n">actives</span><span class="p">,</span> <span class="n">scores</span><span class="p">):</span>
    <span class="s">"""
    :type actives: list[sting]
    :type scores: list[tuple(string, float)]
    :rtype: tuple(list[float], list[float])
    """</span>
    <span class="n">tpr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>  <span class="c"># true positive rate</span>
    <span class="n">fpr</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span>  <span class="c"># false positive rate</span>
    <span class="n">nractives</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">actives</span><span class="p">)</span>
    <span class="n">nrdecoys</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">actives</span><span class="p">)</span>   
    <span class="n">foundactives</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">founddecoys</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">scores</span><span class="p">):</span>   
        <span class="k">if</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">actives</span><span class="p">:</span> <span class="n">foundactives</span> <span class="o">+=</span> <span class="mf">1.0</span>   
        <span class="k">else</span><span class="p">:</span>             <span class="n">founddecoys</span> <span class="o">+=</span> <span class="mf">1.0</span>
        <span class="n">tpr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">foundactives</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nractives</span><span class="p">))</span>
        <span class="n">fpr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">founddecoys</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">nrdecoys</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">fpr</span>

<span class="k">def</span> <span class="nf">draw_ROC</span><span class="p">():</span>
    <span class="n">randomline</span><span class="o">=</span><span class="bp">True</span>
    <span class="n">label</span><span class="o">=</span><span class="s">'Label ABC'</span>
    <span class="c">#----------------------------------------------------------------</span>
    <span class="n">actives</span><span class="o">=</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="s">'G'</span><span class="p">,</span> <span class="s">'J'</span><span class="p">,</span> <span class="s">'L'</span><span class="p">,</span> <span class="s">'N'</span><span class="p">,</span> <span class="s">'O'</span><span class="p">]</span>
    <span class="n">scores</span><span class="o">=</span> <span class="p">[(</span><span class="s">'A'</span><span class="p">,</span> <span class="mf">0.11</span><span class="p">),</span> <span class="p">(</span><span class="s">'B'</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="p">(</span><span class="s">'C'</span><span class="p">,</span> <span class="mf">0.72</span><span class="p">),</span> <span class="p">(</span><span class="s">'D'</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span> <span class="p">(</span><span class="s">'E'</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">),</span> <span class="p">(</span><span class="s">'F'</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">),</span> <span class="p">(</span><span class="s">'G'</span><span class="p">,</span> <span class="mf">0.32</span><span class="p">),</span> <span class="p">(</span><span class="s">'H'</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">),</span> <span class="p">(</span><span class="s">'I'</span><span class="p">,</span> <span class="mf">0.22</span><span class="p">),</span> <span class="p">(</span><span class="s">'J'</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">),</span> <span class="p">(</span><span class="s">'K'</span><span class="p">,</span> <span class="mf">0.56</span><span class="p">),</span> <span class="p">(</span><span class="s">'L'</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">),</span> <span class="p">(</span><span class="s">'M'</span><span class="p">,</span> <span class="mf">0.42</span><span class="p">),</span> <span class="p">(</span><span class="s">'N'</span><span class="p">,</span> <span class="mf">0.73</span><span class="p">),</span> <span class="p">(</span><span class="s">'O'</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">),</span> <span class="p">(</span><span class="s">'P'</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">),</span> <span class="p">(</span><span class="s">'Q'</span><span class="p">,</span> <span class="mf">0.71</span><span class="p">),</span> <span class="p">(</span><span class="s">'R'</span><span class="p">,</span> <span class="mf">0.82</span><span class="p">),</span>
            <span class="c">#('A', 0.11), ('B', 0.35), ('C', 0.72), ('D', 0.1), ('E', 0.99), ('F', 0.44), ('G', 0.32), ('H', 0.8), ('I', 0.22), ('J', 0.08), ('K', 0.56), ('L', 0.48), ('M', 0.42), ('N', 0.73), ('O', 0.03), ('P', 0.65), ('Q', 0.71), ('R', 0.82)</span>
             <span class="p">]</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scores</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">itemgetter</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
    <span class="c">#--------------------# depict_ROC_curve(actives, sortedscores, label, color, ofname)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Plotting ROC Curve ..."</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">"FPR"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">"TPR"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">"ROC Curve"</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c">#--------------------------------# add_ROC_curve(plt, actives, scores, color, label)</span>
    <span class="n">tpr</span><span class="p">,</span> <span class="n">fpr</span> <span class="o">=</span> <span class="n">get_rates</span><span class="p">(</span><span class="n">actives</span><span class="p">,</span> <span class="n">scores</span><span class="p">)</span>
    <span class="n">roc_auc</span> <span class="o">=</span> <span class="n">auc</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">)</span>
    <span class="n">roc_label</span> <span class="o">=</span> <span class="s">'{} (AUC={:.3f})'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">roc_auc</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fpr</span><span class="p">,</span> <span class="n">tpr</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'b'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">roc_label</span><span class="p">)</span>
    <span class="c">#-----------------------------------------------# save_ROC_curve_plot(plt, filename=ofname, randomline=True)</span>
    <span class="k">if</span> <span class="n">randomline</span><span class="p">:</span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">'dashed'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">'red'</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s">'random'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s">'best'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="c"># plt.savefig(filename)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">return</span> <span class="mi">0</span>
<span class="n">draw_ROC</span><span class="p">()</span>
</code></pre></div></div>

<p>Kết quả</p>

<p><img src="/assets/images/postimg/ROC.svg" alt="" /></p>

<p>Các file đầu vào: <a href="/assets/files/draw-ROC.zip">code.py, actives.txt, scores_bad.txt,scores_good.txt,scores_normal.txt</a></p>




        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#asr" class="page__taxonomy-item" rel="tag">ASR</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#deep-learning" class="page__taxonomy-item" rel="tag">Deep-Learning</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#papers" class="page__taxonomy-item" rel="tag">Papers</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#wer" class="page__taxonomy-item" rel="tag">WER</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#wer" class="page__taxonomy-item" rel="tag">WER</a>
    
    </span>
  </p>




        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-12-26T00:00:00+08:00">December 26, 2018</time></p>
        
      </footer>
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section class="fb-comments" data-href="http://localhost:4000/portfolio/Cach-tinh-ROC-curve/" data-mobile="true" data-num-posts="10" data-width="100%" data-colorscheme="light"></section>
    
</div>

      <!-- <section class="page__share">
<h3> Bình luận chung cho cả trang web =>> thêm link vào bình luận nhé.</h3>
<div class="fb-comments" data-href="https://holianh.github.io/" data-numposts="10"></div>
</section>  -->

<section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=tuananhktmt&text=ROC+curves+Confution+matrix+%E2%80%93+what+are+they+and+how+are+they+used%3F%20http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2FCach-tinh-ROC-curve%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2FCach-tinh-ROC-curve%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://plus.google.com/share?url=http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2FCach-tinh-ROC-curve%2F" class="btn btn--google-plus" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Google Plus"><i class="fab fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fportfolio%2FCach-tinh-ROC-curve%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/portfolio/Cach-tinh-WER/" class="pagination--pager" title="Word Error Rate (WER) and Word Recognition Rate (WRR) with Python
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    <!--  -->

  </article>




  
  
</div>

    </div>

    


    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- <center>
<div class="fb-comments" data-href="https://holianh.github.io/" data-numposts="10"></div>
</center> -->

<!-- end custom footer snippets -->

        <!-- <center>
<div class="fb-comments" data-href="https://holianh.github.io/" data-numposts="10"></div>
</center> -->

<div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/tuananhktmt"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
          <li><a href="https://facebook.com/anh211"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i> Facebook</a></li>
        
      
        
          <li><a href="https://github.com/holianh"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://youtube.com/tuananhktmt"><i class="fab fa-fw fa-instagram" aria-hidden="true"></i> youtube</a></li>
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2019 Tuấn Anh. Made with ❤</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.2.0/js/all.js"></script>






  
      <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.5&appId=2341188262621006";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
    



  </body>
</html>
